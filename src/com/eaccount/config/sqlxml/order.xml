<?xml version="1.0" encoding="UTF-8"?>


<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Order">

    <resultMap type="com.eaccount.domain.Order" id="OrderResult">
        <!-- Order表 -->
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="order_id" jdbcType="VARCHAR" property="order_id"/>
        <result column="company_id_seller" jdbcType="INTEGER" property="company_id_seller"/>
        <result column="company_id_buyer" jdbcType="INTEGER" property="company_id_buyer"/>
        <result column="user_id_seller" jdbcType="INTEGER" property="user_id_seller"/>
        <result column="user_id_buyer" jdbcType="INTEGER" property="user_id_buyer"/>
        <result column="place_order_time" jdbcType="DATE" property="place_order_time"/>
        <result column="receiving_time" jdbcType="DATE" property="receiving_time"/>
        <result column="total_price_seller" jdbcType="INTEGER" property="total_price_seller"/>
        <result column="total_price_buyer" jdbcType="INTEGER" property="total_price_buyer"/>
        <result column="paid_price" jdbcType="INTEGER" property="paid_price"/>
        <result column="is_reconciliation" jdbcType="INTEGER" property="is_reconciliation"/>
        <result column="payment_day" jdbcType="INTEGER" property="payment_day"/>

        <!-- companyINFO -->
        <result column="company_logo" jdbcType="BLOB" property="company_logo"/>
        <result column="company_name" jdbcType="VARCHAR" property="company_name"/>

        <!-- 商品种类及数量 -->
        <result column="type_number" jdbcType="INTEGER" property="type_number"/>
        <result column="product_number" jdbcType="INTEGER" property="product_number"/>
        <!-- 用户信息 -->
        <result column="user_name" jdbcType="VARCHAR" property="user_name"/>
        <result column="user_phone_number" jdbcType="VARCHAR" property="user_phone_number"/>

        <!-- 凭据照片 -->
        <result column="photo" jdbcType="BLOB" property="photo"/>
    </resultMap>

    <select id="SelectOrderInfoByUserId" parameterType="com.eaccount.domain.Order" resultMap="OrderResult">
        SELECT a.order_id, c.company_logo, c.company_name, a.place_order_time, a.receiving_time, d.user_name, d.user_phone_number, COUNT(*) AS type_number, COUNT(b.quantity_delivery) AS product_number
        FROM table_order a, table_order_detail b, table_company_profile c , table_user_profile d WHERE 1 = 1
        AND a.user_id_seller = #{user_id_seller}
        AND a.order_id = b.order_id
        AND a.company_id_buyer = c.id
        AND a.user_id_buyer = d.id
        <if test="type == 1">
            AND a.receiving_time IS NOT NULL
        </if>
        <if test="type == 2">
            AND a.receiving_time IS NULL
        </if>
        GROUP BY a.order_id
        ORDER BY a.place_order_time
    </select>
    <select id="SelectOrderInfoByOrderId" parameterType="com.eaccount.domain.Order" resultMap="OrderResult">
        SELECT c.company_logo, c.company_name, c.company_address, b.user_name, b.user_phone_number, a.place_order_time, a.receiving_time, d.photo
        FROM table_order a, table_user_profile b, table_company_profile c, table_photo d
        WHERE 1 = 1
        AND a.order_id = #{order_id}
        AND a.user_id_buyer = b.id
        AND company_id_buyer = c.id
        AND a.order_id = d.order_id
        AND photo_type = 1
    </select>

</mapper>